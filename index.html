<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNG to JPG/WebP Optimizer Pro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Biblioteki -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .drag-active { border-color: #3b82f6; background-color: #eff6ff; }
        /* Szachownica dla t≈Ça podglƒÖdu */
        .checkerboard {
            background-color: #eee;
            background-image: linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), 
                              linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- LEWA KOLUMNA: KONTROLKI (2/3 szeroko≈õci) -->
        <div class="lg:col-span-2 space-y-6">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h1 class="text-2xl font-bold text-gray-800 mb-2 border-b pb-4">
                    Optymalizator Obraz√≥w Pro
                </h1>
                
                <!-- Ostrze≈ºenia -->
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 text-sm text-yellow-800">
                    <p class="font-bold">‚ö†Ô∏è Uwaga dotyczƒÖca wydajno≈õci</p>
                    <p>Przetwarzanie odbywa siƒô w Twojej przeglƒÖdarce. Przy setkach zdjƒôƒá lub bardzo du≈ºych plikach (RAW/TIFF) przeglƒÖdarka mo≈ºe zwolniƒá. Zalecamy partie do 50-100 zdjƒôƒá naraz.</p>
                </div>

                <!-- SEKCJA 1: ≈πr√≥d≈Ço -->
                <div class="mb-8">
                    <h2 class="text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">1</span> 
                        Wyb√≥r plik√≥w
                    </h2>
                    
                    <div class="flex gap-4 mb-4">
                        <button id="btnSelectFiles" class="flex-1 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-2 px-4 rounded-lg shadow-sm transition-all text-sm font-semibold">
                            üìÑ Wybierz pliki
                        </button>
                        <button id="btnSelectFolder" class="flex-1 bg-blue-50 border border-blue-200 hover:bg-blue-100 text-blue-700 py-2 px-4 rounded-lg shadow-sm transition-all text-sm font-semibold">
                            üìÅ Wybierz folder (Masowo)
                        </button>
                    </div>

                    <div id="drop-zone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer transition-colors hover:border-blue-400 hover:bg-gray-50">
                        <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
                        <input type="file" id="folderInput" webkitdirectory directory class="hidden">
                        <div class="text-gray-400">
                            <p class="text-3xl mb-2">üì•</p>
                            <p class="font-medium text-gray-600">Upu≈õƒá pliki tutaj</p>
                            <p class="text-sm mt-2" id="fileCount">Nie wybrano plik√≥w</p>
                        </div>
                    </div>
                </div>

                <!-- SEKCJA 2: Format i Rozmiar -->
                <div class="mb-8">
                    <h2 class="text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">2</span> 
                        Ustawienia wyj≈õciowe
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Format -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Format Pliku</label>
                            <select id="formatSelect" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                                <option value="image/jpeg">JPG (Standard)</option>
                                <option value="image/webp">WebP (Nowoczesny, l≈ºejszy)</option>
                                <option value="image/avif">AVIF (Najlepsza kompresja)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">AVIF wymaga nowszej przeglƒÖdarki.</p>
                        </div>

                        <!-- Rozdzielczo≈õƒá -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rozmiar / Skalowanie</label>
                            <select id="resizeSelect" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 bg-white">
                                <option value="1920x1080">Full HD (1920x1080) - WWW</option>
                                <option value="3840x2160">4K UHD (3840x2160)</option>
                                <option value="1080x1080">Kwadrat (1080x1080) - Instagram</option>
                                <option value="1080x1350">Portret (1080x1350) - Social</option>
                                <option value="1200x630">Facebook Link (1200x630)</option>
                                <option value="original">Oryginalny rozmiar (Bez zmian)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Jako≈õƒá -->
                    <div class="mt-4">
                        <div class="flex justify-between mb-1">
                            <label class="text-sm font-medium text-gray-700">Jako≈õƒá kompresji</label>
                            <span id="qualityValue" class="font-bold text-blue-600 text-sm">75%</span>
                        </div>
                        <input type="range" id="qualityRange" min="10" max="100" value="75" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>

                <!-- SEKCJA 3: Logo -->
                <div class="mb-8 border-t pt-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold text-gray-700 flex items-center gap-2">
                            <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">3</span> 
                            Znak wodny / Logo
                        </h2>
                        <label class="flex items-center space-x-2 cursor-pointer select-none">
                            <input type="checkbox" id="logoCheck" class="w-5 h-5 text-blue-600 rounded">
                            <span class="text-gray-700 font-medium">W≈ÇƒÖcz</span>
                        </label>
                    </div>

                    <div id="logoOptions" class="opacity-50 pointer-events-none transition-opacity duration-200 bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Wybierz plik logo</label>
                                <input type="file" id="logoInput" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200 cursor-pointer">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Pozycja</label>
                                <select id="logoPosition" class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                                    <option value="bottom-right">Prawy Dolny</option>
                                    <option value="bottom-left">Lewy Dolny</option>
                                    <option value="top-right">Prawy G√≥rny</option>
                                    <option value="top-left">Lewy G√≥rny</option>
                                    <option value="center">Idealny ≈örodek</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- START BUTTON -->
                <button id="processBtn" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition transform active:scale-95 flex justify-center items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span class="text-xl">üöÄ</span>
                    <span class="text-lg">Rozpocznij Optymalizacjƒô</span>
                </button>

                <!-- Pasek postƒôpu -->
                <div id="progressContainer" class="hidden mt-6 bg-gray-100 rounded-lg p-4">
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                        <span id="statusText">Inicjalizacja...</span>
                        <span id="percentText">0%</span>
                    </div>
                    <div class="w-full bg-gray-300 rounded-full h-3 overflow-hidden">
                        <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- PRAWA KOLUMNA: PODGLƒÑD (1/3 szeroko≈õci, Sticky) -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-lg p-6 sticky top-6">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                    üëÅÔ∏è PodglƒÖd Logo
                </h3>
                <p class="text-xs text-gray-500 mb-4">
                    Poni≈ºej widaƒá przyk≈ÇadowƒÖ grafikƒô (placeholder) z na≈Ço≈ºonym Twoim logo. Pozwala to sprawdziƒá pozycjƒô znaku wodnego.
                </p>

                <!-- Kontener PodglƒÖdu -->
                <div class="checkerboard w-full aspect-video rounded-lg border border-gray-300 overflow-hidden relative flex items-center justify-center bg-gray-200">
                    <canvas id="previewCanvas" class="max-w-full max-h-full shadow-sm"></canvas>
                </div>

                <div class="mt-4 text-xs text-gray-400 text-center">
                    PodglƒÖd od≈õwie≈ºa siƒô automatycznie po zmianie ustawie≈Ñ.
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- ZMIENNE ---
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');
        const folderInput = document.getElementById('folderInput');
        const btnSelectFiles = document.getElementById('btnSelectFiles');
        const btnSelectFolder = document.getElementById('btnSelectFolder');
        const fileCount = document.getElementById('fileCount');

        const formatSelect = document.getElementById('formatSelect');
        const resizeSelect = document.getElementById('resizeSelect');
        const qualityRange = document.getElementById('qualityRange');
        const qualityValue = document.getElementById('qualityValue');

        const logoCheck = document.getElementById('logoCheck');
        const logoOptions = document.getElementById('logoOptions');
        const logoInput = document.getElementById('logoInput');
        const logoPosition = document.getElementById('logoPosition');

        const processBtn = document.getElementById('processBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        const percentText = document.getElementById('percentText');

        const previewCanvas = document.getElementById('previewCanvas');
        const previewCtx = previewCanvas.getContext('2d');

        let filesToProcess = [];
        let userLogoImg = null;

        // Placeholder Image (Generowany programowo, ≈ºeby nie zale≈ºeƒá od sieci)
        const placeholderImg = new Image();
        
        // Funkcja generujƒÖca prosty placeholder t≈Ça
        function generatePlaceholder() {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 450;
            const ctx = canvas.getContext('2d');
            
            // T≈Ço gradient
            const grd = ctx.createLinearGradient(0, 0, 800, 450);
            grd.addColorStop(0, "#e0e7ff");
            grd.addColorStop(1, "#f3f4f6");
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, 800, 450);

            // Linie siatki
            ctx.strokeStyle = "#cbd5e1";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(400, 0); ctx.lineTo(400, 450); // Pion
            ctx.moveTo(0, 225); ctx.lineTo(800, 225); // Poziom
            ctx.stroke();

            // Tekst
            ctx.fillStyle = "#94a3b8";
            ctx.font = "bold 30px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("Przyk≈Çadowa Grafika", 400, 225);
            ctx.font = "20px sans-serif";
            ctx.fillText("Obraz t≈Ça (Placeholder)", 400, 260);

            placeholderImg.src = canvas.toDataURL();
            placeholderImg.onload = drawPreview;
        }

        // --- OBS≈ÅUGA UI ---

        // Inicjalizacja
        generatePlaceholder();

        // Listenery do od≈õwie≈ºania podglƒÖdu
        [resizeSelect, logoCheck, logoPosition].forEach(el => {
            el.addEventListener('change', drawPreview);
        });

        // Suwak jako≈õci
        qualityRange.addEventListener('input', (e) => {
            qualityValue.textContent = e.target.value + '%';
        });

        // Checkbox Logo
        logoCheck.addEventListener('change', (e) => {
            if (e.target.checked) {
                logoOptions.classList.remove('opacity-50', 'pointer-events-none');
            } else {
                logoOptions.classList.add('opacity-50', 'pointer-events-none');
            }
        });

        // Wczytywanie pliku logo
        logoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => { 
                        userLogoImg = img; 
                        drawPreview(); // Od≈õwie≈º podglƒÖd po za≈Çadowaniu logo
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Funkcja rysujƒÖca podglƒÖd
        function drawPreview() {
            // Ustalamy wymiary podglƒÖdu (proporcjonalnie do wybranej rozdzielczo≈õci)
            const targetDim = getTargetDimensions(placeholderImg.width, placeholderImg.height);
            
            // Ustawiamy wielko≈õƒá canvasa podglƒÖdu (skalowanƒÖ w d√≥≈Ç ≈ºeby siƒô zmie≈õci≈Ça w UI)
            // Ale obliczenia pozycji logo robimy na "wirtualnym" pe≈Çnym rozmiarze
            
            // Prosty trick: Rysujemy na canvasie o sta≈Çej szeroko≈õci np. 400px, zachowujƒÖc proporcje celu
            const previewWidth = 400;
            const aspect = targetDim.w / targetDim.h;
            const previewHeight = previewWidth / aspect;

            previewCanvas.width = previewWidth;
            previewCanvas.height = previewHeight;

            // Rysowanie t≈Ça (placeholder)
            // U≈ºywamy "cover" logic dla placeholdera
            const scale = Math.max(previewWidth / placeholderImg.width, previewHeight / placeholderImg.height);
            const x = (previewWidth / 2) - (placeholderImg.width / 2) * scale;
            const y = (previewHeight / 2) - (placeholderImg.height / 2) * scale;
            
            previewCtx.drawImage(placeholderImg, x, y, placeholderImg.width * scale, placeholderImg.height * scale);

            // Rysowanie logo (je≈õli w≈ÇƒÖczone i za≈Çadowane)
            if (logoCheck.checked && userLogoImg) {
                // Skala miƒôdzy "prawdziwym" rozmiarem wyj≈õciowym a podglƒÖdem
                // np. je≈õli wyj≈õcie to 1920px, a podglƒÖd ma 400px, to ratio = 400/1920
                const previewRatio = previewWidth / targetDim.w;

                const logoW = userLogoImg.width * previewRatio; // Logo skaluje siƒô wizualnie
                const logoH = userLogoImg.height * previewRatio;

                // Margines 3% (taki sam jak w logice processingu)
                const marginX = previewWidth * 0.03;
                const marginY = previewHeight * 0.03;

                let lx = 0, ly = 0;
                const pos = logoPosition.value;

                switch(pos) {
                    case 'bottom-right':
                        lx = previewWidth - logoW - marginX;
                        ly = previewHeight - logoH - marginY;
                        break;
                    case 'bottom-left':
                        lx = marginX;
                        ly = previewHeight - logoH - marginY;
                        break;
                    case 'top-right':
                        lx = previewWidth - logoW - marginX;
                        ly = marginY;
                        break;
                    case 'top-left':
                        lx = marginX;
                        ly = marginY;
                        break;
                    case 'center':
                        lx = (previewWidth - logoW) / 2;
                        ly = (previewHeight - logoH) / 2;
                        break;
                }

                // Cie≈Ñ pod logo dla lepszej widoczno≈õci w podglƒÖdzie
                previewCtx.shadowColor = "rgba(0,0,0,0.3)";
                previewCtx.shadowBlur = 5;
                previewCtx.drawImage(userLogoImg, lx, ly, logoW, logoH);
                previewCtx.shadowBlur = 0;
            } else if (logoCheck.checked && !userLogoImg) {
                // Info ≈ºe brakuje logo
                previewCtx.fillStyle = "rgba(0,0,0,0.5)";
                previewCtx.fillRect(0, previewHeight - 30, previewWidth, 30);
                previewCtx.fillStyle = "white";
                previewCtx.font = "12px sans-serif";
                previewCtx.textAlign = "center";
                previewCtx.fillText("Wybierz plik logo, aby zobaczyƒá podglƒÖd", previewWidth/2, previewHeight - 10);
            }
        }

        // Helper do wymiar√≥w
        function getTargetDimensions(origW, origH) {
            const val = resizeSelect.value;
            if (val === 'original') return { w: origW, h: origH };
            
            const [w, h] = val.split('x').map(Number);
            return { w, h };
        }

        // --- WYB√ìR PLIK√ìW ---
        btnSelectFiles.addEventListener('click', () => fileInput.click());
        btnSelectFolder.addEventListener('click', () => folderInput.click());
        
        dropZone.addEventListener('click', (e) => {
            if(e.target !== fileInput && e.target !== folderInput) fileInput.click();
        });

        // Drag & Drop events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => { e.preventDefault(); e.stopPropagation(); }, false);
        });
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-active'), false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-active'), false);
        });

        dropZone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files));
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        folderInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            const validFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
            if (validFiles.length > 0) {
                filesToProcess = validFiles;
                let sizeMB = (Array.from(validFiles).reduce((acc, f) => acc + f.size, 0) / (1024*1024)).toFixed(1);
                
                fileCount.innerHTML = `
                    <span class="text-green-600 font-bold">Wybrano: ${validFiles.length} plik√≥w</span>
                    <span class="text-gray-400 text-xs block">Rozmiar ca≈Çkowity: ${sizeMB} MB</span>
                `;

                if (validFiles.length > 100) {
                    alert("Wybrano du≈ºo plik√≥w (" + validFiles.length + "). Przetwarzanie mo≈ºe chwilƒô potrwaƒá. Prosimy o cierpliwo≈õƒá.");
                }
            }
        }

        // --- START PRZETWARZANIA ---
        processBtn.addEventListener('click', async () => {
            if (filesToProcess.length === 0) {
                alert('Proszƒô najpierw wybraƒá pliki!');
                return;
            }

            // Blokada UI
            processBtn.disabled = true;
            processBtn.classList.add('opacity-75');
            progressContainer.classList.remove('hidden');
            
            const zip = new JSZip();
            const format = formatSelect.value; // np. image/webp
            const quality = parseInt(qualityRange.value) / 100;
            const useLogo = logoCheck.checked && userLogoImg;
            const logoPos = logoPosition.value;
            const resizeMode = resizeSelect.value;

            // Ustalenie rozszerzenia pliku
            let ext = ".jpg";
            if (format === "image/webp") ext = ".webp";
            if (format === "image/avif") ext = ".avif";

            let processedCount = 0;

            for (let i = 0; i < filesToProcess.length; i++) {
                const file = filesToProcess[i];
                
                statusText.textContent = `Przetwarzanie: ${file.name}`;
                
                try {
                    const blob = await processImage(file, format, quality, resizeMode, useLogo, userLogoImg, logoPos);
                    
                    // Nowa nazwa pliku
                    const oldName = file.name.substring(0, file.name.lastIndexOf('.')) || file.name;
                    zip.file(`${oldName}${ext}`, blob);

                } catch (err) {
                    console.error("B≈ÇƒÖd pliku:", file.name, err);
                }

                processedCount++;
                const percent = Math.round((processedCount / filesToProcess.length) * 100);
                progressBar.style.width = `${percent}%`;
                percentText.textContent = `${percent}%`;

                // Pauza dla UI (oddajemy sterowanie przeglƒÖdarce co 3 pliki)
                if (i % 3 === 0) await new Promise(r => setTimeout(r, 10));
            }

            // Pakowanie ZIP
            statusText.textContent = "Kompresowanie archiwum ZIP...";
            try {
                const content = await zip.generateAsync({ type: "blob" });
                saveAs(content, `zoptymalizowane_${new Date().getTime()}.zip`);
                statusText.textContent = "Gotowe! Pobieranie...";
            } catch (e) {
                statusText.textContent = "B≈ÇƒÖd pakowania ZIP.";
                alert("WystƒÖpi≈Ç b≈ÇƒÖd przy tworzeniu ZIP. Mo≈ºe pliki sƒÖ za du≈ºe dla pamiƒôci przeglƒÖdarki?");
            }

            // Reset UI
            setTimeout(() => {
                processBtn.disabled = false;
                processBtn.classList.remove('opacity-75');
                statusText.textContent = "Zako≈Ñczono.";
            }, 2000);
        });

        // --- CORE LOGIC ---
        function processImage(file, mimeType, quality, resizeMode, useLogo, logoImg, logoPos) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // 1. Obliczanie wymiar√≥w
                        let targetW, targetH;
                        
                        if (resizeMode === 'original') {
                            targetW = img.width;
                            targetH = img.height;
                        } else {
                            [targetW, targetH] = resizeMode.split('x').map(Number);
                        }

                        canvas.width = targetW;
                        canvas.height = targetH;

                        // 2. Rysowanie Obrazu (Smart Crop / Fill)
                        // Obliczamy skalƒô, aby wype≈Çniƒá ca≈Çy obszar (cover)
                        const scale = Math.max(targetW / img.width, targetH / img.height);
                        const x = (targetW / 2) - (img.width / 2) * scale;
                        const y = (targetH / 2) - (img.height / 2) * scale;

                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);

                        // 3. Rysowanie Logo
                        if (useLogo && logoImg) {
                            const logoW = logoImg.width;
                            const logoH = logoImg.height;
                            
                            // Margines 3% szeroko≈õci
                            const marginX = targetW * 0.03;
                            const marginY = targetH * 0.03;

                            let lx = 0, ly = 0;

                            switch(logoPos) {
                                case 'bottom-right':
                                    lx = targetW - logoW - marginX;
                                    ly = targetH - logoH - marginY;
                                    break;
                                case 'bottom-left':
                                    lx = marginX;
                                    ly = targetH - logoH - marginY;
                                    break;
                                case 'top-right':
                                    lx = targetW - logoW - marginX;
                                    ly = marginY;
                                    break;
                                case 'top-left':
                                    lx = marginX;
                                    ly = marginY;
                                    break;
                                case 'center':
                                    lx = (targetW - logoW) / 2;
                                    ly = (targetH - logoH) / 2;
                                    break;
                            }
                            ctx.drawImage(logoImg, lx, ly, logoW, logoH);
                        }

                        // 4. Eksport
                        canvas.toBlob((blob) => {
                            if (!blob) reject("Canvas error");
                            // SprzƒÖtanie pamiƒôci
                            canvas.width = 1; canvas.height = 1;
                            resolve(blob);
                        }, mimeType, quality);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
